<template>
    <template if:true={isLastPage}>
    <div class="updatebutton">
        <lightning-button label="Update" onclick={handleupdate} variant="brand" class="slds-m-right_small">
            </lightning-button>
    </div>
    </template>
    <template if:false={seeFinalOnly}>

        <!-- Carousel Navigation -->
        <div class="slds-align_absolute-center slds-m-vertical_medium">
            <lightning-button label="Previous" onclick={handlePrev} class="slds-m-right_small" disabled={prevDisabled}>
            </lightning-button>

            <span class="slds-text-heading_medium slds-m-horizontal_medium">
            {currentProductName} ({currentPosition} of {totalProducts})
        </span>

            <lightning-button label="Next" onclick={handleNext} class="slds-m-left_small" disabled={nextDisabled}>
            </lightning-button>
        </div>
    </template>
    <template if:true={isLastPage}>
        <div class="slds-m-top_large summary-view">
            <h3 class="slds-text-heading_medium slds-m-bottom_medium">Project Summary</h3>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="slds-card">
                        <div class="slds-card__body">
                            <dl class="summary-list">
                                <dt>Final Price:</dt>
                                <dd>INR/Wp: {summaryTotals.finalPrice}</dd>
                                <dd>Cents/Wp: {summaryTotals.finalPriceinCent}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template if:false={seeFinalOnly}>
        <div class="slds-grid slds-gutters slds-m-bottom_medium">
            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox label="Country Source" value={countrySource} options={countryOptions}
                    onchange={handleCountryChange} disabled={isDisabled}>
                </lightning-combobox>
            </div>
            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox label="Pricing Type" value={pricingType} options={pricingOptions}
                    onchange={handlePricingChange} disabled={isDisabled}>
                </lightning-combobox>
            </div>
        </div>
        <!-- Current Product Display -->

        <template if:true={currentProduct}>
            <div class="product-card">
                <h3 class="product-name slds-text-heading_medium slds-p-bottom_small">
                    {currentProductName} Details
                </h3>
                <div class="table-container">
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered raw-materials-table">
                        <thead>
                            <tr class="slds-text-title_bold">
                                <th>Raw Material</th>
                                <th>UOM</th>
                                <th>Net BoQ</th>
                                <th>Raw Cost/Module(USD)</th>
                                <th>Raw Cost/Module(INR)</th>
                                <th>Freight/module (INR)</th>
                                <th>Insurance (INR)</th>
                                <th>Duty/Module (INR)</th>
                                <th>DDP Cost/Module(INR)</th>
                                <th>INR/Wp</th>
                                <th>Cents/Wp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={currentProduct.materials} for:item="material" for:index="index">
                                <tr key={material.rawMaterialId}>
                                    <td>
                                        <template if:true={material.isVariable}>
                                            <div class="combobox-wrapper">
                                                <lightning-combobox name={material.rawMaterialId}
                                                    data-id={material.dataId} value={material.selectedVariantId}
                                                    options={material.variantOptions} onchange={handleVariantChange}>
                                                </lightning-combobox>
                                            </div>
                                        </template>
                                        <template if:false={material.isVariable}>
                                            {material.rawMaterialName}
                                        </template>
                                    </td>
                                    <td>{material.uom}</td>
                                    <td>{material.requiredQuantityPerUnit}</td>
                                    <td>{material.formattedRawCostUSD}</td>
                                    <td>{material.formattedRawCostINR}</td>
                                    <td>{material.formattedLogistics}</td>
                                    <td>{material.formattedInsurance}</td>
                                    <td>{material.formattedDuty}</td>
                                    <td>{material.formattedDdp}</td>
                                    <td>{material.formattedInrWp}</td>
                                    <td>{material.formattedCentsDp}</td>
                                </tr>
                            </template>
                            <tr class="total-row">
                                <td>Total</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>{currentProduct.totalInrWp}</td>
                                <td>{currentProduct.totalCentWp}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="cost-breakdown slds-m-top_large">
                    <h4 class="slds-text-heading_small slds-m-bottom_small">Cost Breakdown</h4>
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered raw-materials-table">
                        <thead>
                            <tr>
                                <th>Particulars</th>
                                <th>INR/Wp</th>
                                <th>Cents/Wp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={costRows} for:item="row">
                                <tr key={row.label}>
                                    <td>{row.label}</td>
                                    <td>{row.col2}</td>
                                    <td>{row.col3}</td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </template>


    </template>

</template>